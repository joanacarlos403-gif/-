<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç”˜è‚ƒçœå¦‡å¹¼ä¿å¥é™¢-ä»‹å…¥ä¸è¡€ç®¡å¤–ç§‘ç”¨è¯åŠ©æ‰‹</title>
    <style>
        /* æ ¸å¿ƒç¾åŒ–å˜é‡ */
        :root { 
            --primary: #005a96; 
            --primary-light: #e6f0f7;
            --accent: #d32f2f; 
            --text-main: #2c3e50;
            --bg-side: #ffffff;
            --bg-main: #f4f7f9;
        }

        body { font-family: "PingFang SC", "Microsoft YaHei", sans-serif; background: var(--bg-main); margin: 0; display: flex; color: var(--text-main); }

        /* å·¦ä¾§æ§åˆ¶å°ç¾åŒ– */
        .no-print-area { 
            width: 380px; padding: 25px; background: var(--bg-side); height: 100vh; 
            position: fixed; left: 0; top: 0; box-shadow: 4px 0 15px rgba(0,0,0,0.05); 
            overflow-y: auto; z-index: 100; border-right: 1px solid #e0e6ed;
        }
        h3 { color: var(--primary); margin-top: 0; font-size: 20px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .form-section { margin-bottom: 25px; }
        label { font-size: 14px; color: #556677; font-weight: 600; display: block; margin-bottom: 8px; }
        input { 
            width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 8px; 
            box-sizing: border-box; font-size: 14px; transition: all 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(0,90,150,0.1); }
        
        /* è¯ç‰©åˆ—è¡¨äº¤äº’ç¾åŒ– */
        .drug-selector-item { 
            margin-top: 12px; padding: 15px; background: #ffffff; border: 1px solid #eef2f6; 
            border-radius: 10px; transition: all 0.2s; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .drug-selector-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .drug-checkbox { display: flex; align-items: center; font-weight: bold; color: var(--primary); font-size: 15px; }
        .dosage-input-wrapper { margin-top: 12px; display: none; }
        .dosage-input-wrapper.active { display: block; animation: slideDown 0.3s ease-out; }
        .dosage-input { background: #fffcf0; border: 1px solid #f9e1a0; color: #856404; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* æ‰“å°æŒ‰é’® */
        .btn-print { 
            background: linear-gradient(135deg, var(--primary), #007bbd); color:white; border:none; 
            padding: 16px; width:100%; border-radius:10px; cursor:pointer; font-weight:bold; 
            font-size:16px; margin-top: 20px; box-shadow: 0 4px 15px rgba(0,90,150,0.3); transition: 0.3s;
        }
        .btn-print:hover { opacity: 0.9; transform: scale(1.02); }

        /* å³ä¾§ A4 çº¸æ¨¡æ‹Ÿ */
        .preview-container { margin-left: 380px; padding: 40px; width: calc(100% - 380px); display: flex; flex-direction: column; align-items: center; }
        .a4-page { 
            width: 210mm; min-height: 296mm; padding: 20mm 15mm; 
            background: white; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            box-sizing: border-box; position: relative; border-radius: 2px;
        }

        /* æ•™è‚²å•æ’ç‰ˆç¾åŒ– */
        .header-box { text-align: center; border-bottom: 3px solid var(--primary); margin-bottom: 25px; padding-bottom: 15px; }
        .hospital-logo { width: 220px; margin-bottom: 12px; }
        .hospital-name { font-size: 22px; font-weight: bold; color: var(--primary); margin: 0; }
        .doc-title { font-size: 28px; font-weight: 900; color: #333; margin: 12px 0; letter-spacing: 4px; }

        .patient-bar { 
            display: grid; grid-template-columns: 1.2fr 1.5fr 2fr; gap: 10px;
            background: #f8fbfc; padding: 12px 20px; margin-bottom: 25px; 
            font-weight: bold; font-size: 15px; border: 1px solid #e1e9ef; border-radius: 6px; 
        }
        
        .drug-row { 
            display: flex; align-items: flex-start; margin-bottom: 20px; 
            padding: 20px; border: 1px solid #edf2f7; border-radius: 12px;
            background: #ffffff; page-break-inside: avoid;
        }
        .drug-info-text { flex: 1; padding-right: 25px; }
        .drug-title { font-size: 19px; color: var(--primary); font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; }
        .drug-title::before { content: ""; width: 4px; height: 18px; background: var(--primary); margin-right: 10px; border-radius: 2px; }
        
        .dosage-display { 
            color: var(--accent); font-weight: bold; font-size: 16px; margin-bottom: 12px; 
            padding: 6px 12px; background: #fff5f5; display: inline-block; border-radius: 6px; border-left: 4px solid var(--accent);
        }
        .drug-text { font-size: 14.5px; line-height: 1.7; color: #4a5568; white-space: pre-wrap; text-align: justify; }
        
        .drug-qr-box { width: 110px; text-align: center; flex-shrink: 0; background: #fafbfc; border-radius: 8px; padding: 10px; }
        .drug-qr-box img { width: 90px; height: 90px; mix-blend-mode: multiply; }
        .qr-hint { font-size: 11px; color: #a0aec0; margin-top: 8px; font-weight: 500; }

        .footer { position: absolute; bottom: 15mm; left: 15mm; right: 15mm; border-top: 1px solid #e2e8f0; padding-top: 15px; font-size: 12px; color: #718096; }
        .sign-area { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 20px; }
        .sign-dept { font-weight: bold; font-size: 15px; color: #2d3748; line-height: 1.4; text-align: right; }

        /* æ‰“å°é€‚é… */
        @media print {
            .no-print-area { display: none; }
            .preview-container { margin: 0; padding: 0; width: 100%; }
            .a4-page { margin: 0; box-shadow: none; width: 210mm; min-height: 297mm; padding: 15mm; }
            body { background: white; }
            .drug-row { border: 1px solid #eee; }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body>

<div class="no-print-area">
    <h3>ğŸ¥ å®£æ•™å½•å…¥å·¥ä½œå°</h3>
    
    <div class="form-section">
        <label>ç¬¬ä¸€æ­¥ï¼šå¡«å†™æ‚£è€…åŸºæœ¬ä¿¡æ¯</label>
        <input type="text" id="p-name" placeholder="æ‚£è€…å§“å" oninput="draw()">
        <div style="margin-top:10px;"></div>
        <input type="text" id="p-bed" placeholder="åºŠå· / ä½é™¢å·" oninput="draw()">
        <div style="margin-top:10px;"></div>
        <input type="text" id="p-diag" placeholder="ä¸´åºŠè¯Šæ–­ (å¦‚ï¼šä¸‹è‚¢é™è„‰æ›²å¼ )" oninput="draw()">
    </div>

    <div class="form-section">
        <label>ç¬¬äºŒæ­¥ï¼šå‹¾é€‰è¯å“å¹¶æ ¸å¯¹å‰‚é‡</label>
        <div id="selector"></div>
    </div>

    <button class="btn-print" onclick="window.print()">âœ¨ ç”Ÿæˆå¹¶æ‰“å°æŒ‡å¯¼å•</button>
</div>

<div class="preview-container">
    <div class="a4-page" id="main-content">
        <div class="header-box">
            <img src="hospital_logo.png" class="hospital-logo" alt="ç”˜è‚ƒçœå¦‡å¹¼ä¿å¥é™¢ Logo">
            <div class="hospital-name">ç”˜è‚ƒçœå¦‡å¹¼ä¿å¥é™¢ï¼ˆç”˜è‚ƒçœä¸­å¿ƒåŒ»é™¢ï¼‰</div>
            <div class="doc-title">æ‚£è€…ç”¨è¯æ•™è‚²æŒ‡å¯¼å•</div>
        </div>

        <div class="patient-bar">
            <span>å§“åï¼š<span id="v-name">â€”â€”</span></span>
            <span>åºŠå·ï¼š<span id="v-bed">â€”â€”</span></span>
            <span>è¯Šæ–­ï¼š<span id="v-diag">â€”â€”</span></span>
        </div>

        <div id="v-content">
            <div style="text-align:center; color:#cbd5e0; margin-top:120px;">
                <p style="font-size: 48px; margin:0;">ğŸ“</p>
                <p style="font-size: 18px;">è¯·åœ¨å·¦ä¾§å·¥ä½œå°å¼€å§‹å½•å…¥æ•°æ®</p>
            </div>
        </div>

        <div class="footer">
            <p><b>æ¸©é¦¨æç¤ºï¼š</b>è¯·ä¸¥æ ¼éµåŒ»å˜±æœè¯ï¼Œä¸å¯æ“…è‡ªåœè¯æˆ–æ›´æ”¹å‰‚é‡ã€‚æ‰«ç å¯æŸ¥é˜…è¯¥è¯ç‰©çš„è§†å¬åŒ–æ•™è‚²èµ„æ–™ã€‚è‹¥æœè¯æœŸé—´å‡ºç°çš®ç–¹ã€å‰§çƒˆå¤´ç—›ã€é»‘ä¾¿ã€è¡€å°¿æˆ–ç‰™é¾ˆå‡ºè¡€ä¸æ­¢ï¼Œè¯·ç«‹å³å‘ŠçŸ¥åŒ»ç”Ÿæˆ–å°±åŒ»ã€‚</p>
            <div class="sign-area">
                <span id="print-date">æ‰“å°æ—¥æœŸï¼š2026å¹´1æœˆ30æ—¥</span>
                <div class="sign-dept">
                    ä»‹å…¥ä¸è¡€ç®¡å¤–ç§‘<br>
                    è¯å­¦éƒ¨
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. åˆå§‹åŒ–é¡µé¢æ—¶ï¼Œæ£€æŸ¥ç½‘å€é‡Œæœ‰æ²¡æœ‰å¸¦å‚æ•°
window.onload = function() {
    const params = new URLSearchParams(window.location.search);
    if (params.has('name')) {
        // å¦‚æœæœ‰å‚æ•°ï¼Œè¯´æ˜æ˜¯â€œæ‚£è€…æŸ¥çœ‹æ¨¡å¼â€ï¼Œè‡ªåŠ¨å¡«å……å¹¶éšè—æ§åˆ¶å°
        document.getElementById('p-name').value = params.get('name');
        document.getElementById('p-bed').value = params.get('bed');
        document.getElementById('p-diag').value = params.get('diag');
        
        // è§£æé€‰ä¸­çš„è¯å“ä¿¡æ¯ï¼ˆæ ¼å¼ï¼šdrugId_dose|drugId_doseï¼‰
        const selectedStr = params.get('drugs');
        if (selectedStr) {
            const drugList = selectedStr.split('|');
            drugList.forEach(item => {
                const [id, dose] = item.split('_');
                const check = document.getElementById('check-' + id);
                if (check) {
                    check.checked = true;
                    document.getElementById('wrapper-' + id).classList.add('active');
                    document.getElementById('dose-' + id).value = decodeURIComponent(dose);
                }
            });
        }
        draw();
        // éšè—è¯å¸ˆæ“ä½œé¢æ¿
        document.querySelector('.no-print-area').style.display = 'none';
        document.querySelector('.preview-container').style.margin = '0 auto';
    }
    init(); // æ‰§è¡ŒåŸæœ‰çš„åˆå§‹åŒ–é€»è¾‘
};

// 2. è¯å¸ˆç‚¹å‡»â€œç”Ÿæˆåˆ†äº«äºŒç»´ç â€çš„é€»è¾‘
function generateShareQR() {
    const overlay = document.getElementById('qr-overlay');
    overlay.style.display = 'flex';

    // æå–å½“å‰å¡«å†™çš„æ ¸å¿ƒæ•°æ®
    const name = document.getElementById('p-name').value;
    const bed = document.getElementById('p-bed').value;
    const diag = document.getElementById('p-diag').value;
    
    let drugParams = [];
    drugDb.forEach(d => {
        const check = document.getElementById('check-' + d.id);
        if (check && check.checked) {
            const dose = document.getElementById('dose-' + d.id).value;
            drugParams.push(`${d.id}_${encodeURIComponent(dose)}`);
        }
    });

    // æ‹¼æ¥æˆå®Œæ•´çš„å¸¦å‚æ•°ç½‘å€
    const baseUrl = window.location.origin + window.location.pathname;
    const shareUrl = `${baseUrl}?name=${encodeURIComponent(name)}&bed=${encodeURIComponent(bed)}&diag=${encodeURIComponent(diag)}&drugs=${drugParams.join('|')}`;

    // ç”ŸæˆäºŒç»´ç 
    new QRious({
        element: document.getElementById('share-qr'),
        value: shareUrl,
        size: 280
    });
}
    init();
</script>
</body>
</html>
